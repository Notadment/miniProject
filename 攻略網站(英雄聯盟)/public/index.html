<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>titleList</title>
    <link rel="stylesheet" href="./bootstrap-5.2.3-dist/css/bootstrap.css">
    <script src="./bootstrap-5.2.3-dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="./searchBar.CSS">
    <link rel="stylesheet" href="./create.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="./btn.css">
    <style>
        body {
            background-image: url(./backgroundIMG/background.jpg);
        }

        #toFront {
            text-decoration: none;
            color: white;
        }

        #toFront:hover {
            color: rgb(194, 141, 28);
        }
    </style>

</head>

<body style="
background-blend-mode: multiply;
background-color: rgba(80, 31, 31, 0.6);
background-repeat: no-repeat;
background-attachment: fixed;
;">

    <div class="h2 above_area " style="background-image: url(./backgroundIMG/bluebackground.png); ">
        <div>
            <div class="above_bg d-flex">
                <a id="toFront" href="index.html" class="m-3" ><b>英雄攻略網</b></a>
                <div id="userArea" class="ms-auto m-3">
                    <span id="username" style="color: white;"></span>
                    <button id="logoutBtn" onclick="userLogout()" class="button logoutbtn">登出</button>
                </div>
                <a id="loginBtn" href="loginPage.html" class="ms-auto m-3"><button class="button loginbtn ">登入</button></a>
                
            </div>
        </div>
    </div>
    <div class="row " style="margin-bottom: 50px;">
        <div class="col-2"></div>
        <div class="col-8 d-flex">
            <!-- The form -->
            <div class="search-box">
                <button class="btn-search"><i class="fas fa-search"><img src="./backgroundIMG/searchbar.png"
                            style="width: 40px;   margin-left: -5px;"></i></button>
                <input id="searchInput" type="text" class="input-search" placeholder="搜尋英雄">
            </div>
            <button id="createContent" class="ms-auto create" style="width: 100px;" onclick="publishArticle()">
                <a href="./createPage.html" style="text-decoration: none; color:white;">發表文章</a>
            </button>

        </div>
        <div class="col-2">

        </div>
    </div>
    <div class="row ">
        <div class="col-1"></div>
        <div class="col-10 ">
            <!-- style="background-color: rgba(39, 173, 21, 0.5); " -->
            <table id="contentList" class="table table-striped table-hover table-hover table-dark">
                <thead style="height: 50px; text-align: center; ">
                    <tr>
                        <th style="width: 150px;">角色</th>
                        <th style="width: 500px;">主旨</th>
                        <th>發布時間</th>
                        <th style="width: 120px;">作者</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>角色名稱</td>
                        <td><a style="color: rgb(255, 255, 255); text-decoration:none;"
                                href="./ArticlePage.html">點我看內文</a></td>
                        <td>
                            時間
                        </td>
                        <td>Shuan</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-1"></div>
    </div>

    <script>
        var contentTable = [
            { titleId: 1, enChamp: "Aatrox", cnChamp: "厄薩斯", title: "title XXX", contentTxt: "123", upTotal: 5, downTotal: 19, titleTime: "subTime" },
            { titleId: 2, enChamp: "ahri", cnChamp: "阿璃", title: "title YYY", contentTxt: "456", upTotal: 1, downTotal: 12, titleTime: "subTime" },
            { titleId: 3, enChamp: "Akali", cnChamp: "阿卡莉", title: "title ZZZ", contentTxt: "789", upTotal: 1, downTotal: 15, titleTime: "subTime" }
        ];

        // 擷取資料顯示在文章列表內 
        $.get("/title/list", function (e) {

            contentTable = e;
            $('#contentList tbody').empty();
            $.each(contentTable, function (index, item) {
                var trInsert = `
                    <tr>
                        <td >${item.cnChamp}</td>
                        <td><a style="color: rgb(255, 255, 255); text-decoration:none;"  href="./ArticlePage.html?id=${item.titleId}">${item.title}</a></td>
                        <td font-size: smaller;>
                            ${item.titleTime}
                        </td>
                        <td>${item.author} </td>
                    </tr>
                `;
                $("#contentList tbody").append(trInsert);
            })
        })

        function purpEdit(e) {
            sessionStorage.setItem("titleId", e);
        }

        // 在頁面加載時檢查是否已登入
        $(document).ready(function () {
            // 檢查是否登入
            const isLoggedIn = sessionStorage.getItem('username');

            if (isLoggedIn) {
                // 已登入，顯示用戶名稱或其他登入後的內容
                $('#username').text(isLoggedIn);
                // 隱藏登入按鈕，顯示登出按鈕，或其他相應的操作
                $('#loginBtn').hide();
                $('#logoutBtn').show();
                $("#createContent").show();
            } else {
                // 未登入，隱藏登出按鈕，顯示登入按鈕，或其他相應的操作
                $('#logoutBtn').hide();
                $('#loginBtn').show();
                $("#createContent").hide();
            }
            // 搜尋功能
            $('#searchInput').on('input', function () {
                var searchTerm = $(this).val().toLowerCase();
                filterTable(searchTerm);
            });

            // 存儲當前頁面的 URL 到 session storage
            sessionStorage.setItem('previousPage', window.location.href);


        });

        // 登出功能
        function userLogout() {
            // 清除 session storage 中的使用者名稱
            sessionStorage.removeItem('username');

            // 獲取先前的頁面 URL
            var previousPage = sessionStorage.getItem('previousPage');

            // 跳轉到先前的頁面或默認的主頁面
            window.location.href = previousPage || 'http://localhost:8000/';
        }

        function filterTable(searchTerm) {
            // 遍歷表格的每一行
            $('#contentList tbody tr').each(function () {
                var cnName = $(this).find('td:first-child').text().toLowerCase();
                var title = $(this).find('td:nth-child(2)').text().toLowerCase();
                var author = $(this).find('td:nth-child(4)').text().toLowerCase();
                // 檢查是否包含搜尋條件，並顯示或隱藏行
                if (cnName.includes(searchTerm) || title.includes(searchTerm) || author.includes(searchTerm)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }

        // 對使用者名稱作暫存
        function publishArticle() {
            var username = sessionStorage.getItem('username');
        }
    </script>
</body>



</html>